<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NeuroRecall :: Military Grade</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --theme: #69db7c;
            /* Alpha */
            --glow: rgba(105, 219, 124, 0.5);
        }

        /* üåà NEURO PHASING */
        body.phase-1 {
            --theme: #74c0fc;
            --glow: rgba(116, 192, 252, 0.5);
        }

        body.phase-2 {
            --theme: #da77f2;
            --glow: rgba(218, 119, 242, 0.5);
        }

        body.phase-3 {
            --theme: #ffd43b;
            --glow: rgba(255, 212, 59, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #050508;
            font-family: 'Sarabun', sans-serif;
            color: #fff;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            animation: body-breathe 12s cubic-bezier(0.4, 0, 0.2, 1) infinite;
            transition: background 2s;
            /* Background still fades smoothly */
        }

        @keyframes body-breathe {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.04);
            }
        }

        .shorts {
            position: relative;
            width: 90vw;
            max-width: 420px;
            height: 92vh;
            max-height: 800px;
            background: #000;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.9);
            transition: all 0.6s cubic-bezier(0.22, 1, 0.36, 1);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* ‚òÅÔ∏è DREAM IMPRINT (True Color, Blurred Edge) */
        .shorts.imprint {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            max-width: none;
            max-height: none;
            z-index: 10000;
            transform: none;
            animation: none;

            /* Softest Blurred Edges using Mask */
            -webkit-mask-image: radial-gradient(ellipse at center, black 50%, transparent 95%);
            mask-image: radial-gradient(ellipse at center, black 50%, transparent 95%);
            background: #000;

            /* Ensure Original Video Quality */
            filter: none;
            box-shadow: none;
            border-radius: 0;
            transition: none;
        }

        #video {
            position: absolute;
            inset: 0;
            z-index: 1;
            transition: transform 1.5s cubic-bezier(0.22, 1, 0.36, 1), filter 1.5s;
        }

        /* üéØ PROGRESSIVE FOCUS: Zoom per Round */
        .focus-1 #video {
            transform: scale(1);
        }

        .focus-2 #video {
            transform: scale(1.15);
        }

        .focus-3 #video {
            transform: scale(1.35);
            filter: saturate(1.2);
        }

        .focus-4 #video {
            transform: scale(1.6);
            filter: saturate(1.3) contrast(1.1);
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* ‚ö° FLASHBACK OVERLAY */
        #flashback {
            position: absolute;
            inset: 0;
            z-index: 1000;
            background: #000;
            opacity: 0;
            pointer-events: none;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.15s;
        }

        #flashback.show {
            opacity: 1;
        }

        .flashback-text {
            font-size: 1.8rem;
            font-weight: 700;
            color: #ffd43b;
            text-shadow: 0 0 20px #ffd43b80;
            animation: flashPulse 0.5s ease-out;
        }

        @keyframes flashPulse {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }

            50% {
                transform: scale(1.1);
                opacity: 1;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* DEEP FLOW LAYERS */
        .tunnel-vision {
            position: absolute;
            inset: 0;
            z-index: 50;
            pointer-events: none;
            background: radial-gradient(ellipse 70% 60% at 50% 45%,
                    transparent 0%,
                    transparent 40%,
                    rgba(0, 0, 0, 0.3) 60%,
                    rgba(0, 0, 0, 0.7) 80%,
                    rgba(0, 0, 0, 0.95) 100%);
        }

        .heart-pulse {
            position: absolute;
            inset: 0;
            border: 3px solid transparent;
            border-radius: 24px;
            z-index: 200;
            pointer-events: none;
            animation: heartbeat 1s infinite;
        }

        @keyframes heartbeat {

            0%,
            70%,
            100% {
                border-color: transparent;
            }

            35% {
                border-color: var(--glow);
            }
        }

        /* UI OVERLAY */
        .ui-overlay {
            position: absolute;
            inset: 0;
            z-index: 100;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 25px;
            padding-bottom: 120px;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.85) 0%, transparent 35%);
        }

        /* üôà HIDE UI ON IMPRINT */
        .shorts.imprint .ui-overlay,
        .shorts.imprint .progress-wrap,
        .shorts.imprint .status,
        .shorts.imprint .sound-status,
        .shorts.imprint .timeline,
        .shorts.imprint .tunnel-vision,
        .shorts.imprint .heart-pulse {
            opacity: 0 !important;
            transition: none !important;
            /* Instant hide */
        }

        .caption {
            background: rgba(10, 15, 25, 0.9);
            border: 1px solid rgba(126, 184, 218, 0.2);
            border-radius: 18px;
            padding: 18px;
            opacity: 0;
            transform: translateY(15px);
            transition: 0.5s;
        }

        .caption.show {
            opacity: 1;
            transform: translateY(0);
        }

        .text {
            font-size: 1rem;
            line-height: 1.6;
        }

        /* PROGRESS */
        .progress-wrap {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 400;
        }

        .progress-bar {
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--theme);
            width: 0%;
            transition: width 0.3s linear;
            box-shadow: 0 0 10px var(--theme);
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 0.7rem;
            color: #888;
        }

        .status {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 0.7rem;
            z-index: 400;
            color: #888;
        }

        .sound-status {
            position: absolute;
            top: 70px;
            left: 20px;
            font-size: 1.2rem;
            z-index: 410;
            opacity: 0.5;
            animation: sound-pulse 2s infinite;
        }

        @keyframes sound-pulse {

            0%,
            100% {
                opacity: 0.3
            }

            50% {
                opacity: 1
            }
        }


        /* BREATH ANIMATIONS */
        /* ORGANIC BREATH ANIMATIONS (Meditation Style) */
        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes breatheIn {
            0% {
                transform: scale(0.9);
                opacity: 0.3;
                letter-spacing: 0px;
                filter: blur(3px);
                text-shadow: 0 0 20px rgba(105, 219, 124, 0.3);
            }

            30% {
                opacity: 0.8;
                filter: blur(0px);
            }

            100% {
                transform: scale(1.08);
                opacity: 1;
                letter-spacing: 3px;
                filter: blur(0px);
                text-shadow: 0 0 40px rgba(105, 219, 124, 0.8);
            }
        }

        @keyframes breatheOut {
            0% {
                transform: scale(1.08);
                opacity: 1;
                letter-spacing: 3px;
                filter: blur(0px);
                text-shadow: 0 0 40px rgba(218, 119, 242, 0.8);
            }

            70% {
                opacity: 0.8;
                filter: blur(0px);
            }

            100% {
                transform: scale(0.9);
                opacity: 0.3;
                letter-spacing: 0px;
                filter: blur(3px);
                text-shadow: 0 0 20px rgba(218, 119, 242, 0.3);
            }
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        @keyframes pulseGlow {

            0%,
            100% {
                filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.3));
            }

            50% {
                filter: drop-shadow(0 0 35px rgba(255, 255, 255, 0.6));
            }
        }

        /* üå¨Ô∏è BREATH WITH ZOOM */
        @keyframes windIn {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }

            100% {
                transform: scale(1.15);
                opacity: 1;
            }
        }

        @keyframes windOut {
            0% {
                transform: scale(1.15);
                opacity: 1;
            }

            100% {
                transform: scale(0.8);
                opacity: 0;
            }
        }

        @keyframes floatParticles {

            0%,
            100% {
                text-shadow:
                    0 0 20px currentColor,
                    -5px -5px 15px rgba(255, 255, 255, 0.2),
                    5px 5px 15px rgba(255, 255, 255, 0.2);
            }

            50% {
                text-shadow:
                    0 0 30px currentColor,
                    5px -8px 20px rgba(255, 255, 255, 0.3),
                    -5px 8px 20px rgba(255, 255, 255, 0.3);
            }
        }

        /* START */
        #start {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 500;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 30px;
        }

        .topic-list {
            background: rgba(0, 0, 0, 0.9);
            padding: 15px 20px;
            border-radius: 14px;
            border: 1px solid rgba(126, 184, 218, 0.3);
            margin-bottom: 25px;
            text-align: left;
            max-height: 40vh;
            overflow-y: auto;
            width: 100%;
        }

        .topic-list ul {
            list-style: none;
            padding: 0;
        }

        .topic-list li {
            font-size: 0.75rem;
            color: #aaa;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: block;
        }

        .topic-list li:last-child {
            border: none;
        }

        .topic-count {
            font-size: 0.7rem;
            color: #666;
            margin-top: 8px;
        }

        .go {
            padding: 16px 60px;
            background: linear-gradient(135deg, var(--theme), #40c057);
            border: none;
            border-radius: 50px;
            font-size: 1.3rem;
            font-weight: 700;
            color: #0a1a0f;
            cursor: pointer;
            box-shadow: 0 10px 30px var(--glow);
            transition: transform 0.2s, filter 0.2s, box-shadow 0.2s;
        }

        .go:hover {
            transform: scale(1.05);
            filter: brightness(1.1);
            box-shadow: 0 15px 40px var(--glow);
        }

        /* SUBLIMINAL */
        #flash {
            position: absolute;
            inset: 0;
            background: #000;
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
        }

        .flash-w {
            font-size: 4rem;
            font-weight: 900;
            color: var(--theme);
        }

        /* VOID */
        #void {
            position: absolute;
            inset: 0;
            background: #000;
            z-index: 1500;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            /* ‚úÇÔ∏è FRACTIONATION: NO TRANSITION (Sudden Cut) */
            transition: none;
        }

        .void-t {
            font-size: 1.4rem;
            color: #444;
            text-align: center;
        }

        /* DONE */
        #done {
            position: absolute;
            inset: 0;
            background: #000;
            z-index: 1000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        /* TIMELINE */
        .timeline {
            position: absolute;
            right: -50px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            z-index: 10;
        }

        .t-icon {
            font-size: 0.9rem;
            opacity: 0.5;
        }

        .t-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #333;
        }

        .t-dot.on {
            background: var(--theme);
            transform: scale(1.5);
        }

        .t-dot.ok {
            background: var(--theme);
            opacity: 0.7;
        }

        .breath-font {
            font-size: 2.5rem;
            font-weight: 700;
            letter-spacing: 2px;
            text-align: center;
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            /* Organic pulse glow + gradient shift */
            animation: gradientShift 6s ease infinite, pulseGlow 2s ease-in-out infinite;
            /* Keep within container */
            max-width: 90%;
            margin: 0 auto;
        }
    </style>
</head>

<body class="phase-1">

    <div class="shorts">
        <div id="video"></div>

        <!-- Effects -->
        <div class="tunnel-vision"></div>
        <div class="heart-pulse"></div>
        <div class="sound-status">üîä</div>

        <!-- ‚ö° Flashback Overlay -->
        <div id="flashback">
            <div class="flashback-text" id="flashback-text"></div>
        </div>

        <!-- Progress -->
        <div class="progress-wrap">
            <div class="progress-bar">
                <div class="progress-fill" id="progress"></div>
            </div>
            <div class="progress-info">
                <span id="current-num">1</span>/<span id="total-num">0</span>
                <span>Shuffle Round <span id="round">1</span></span>
            </div>
        </div>

        <!-- Status -->
        <div class="status">View: <span id="watched">0</span> | Re: <span id="repeat">0</span></div>

        <!-- Caption -->
        <div class="ui-overlay">
            <div class="caption" id="cap">
                <div class="text" id="txt">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
            </div>
        </div>

        <!-- Start -->
        <div id="start">
            <div style="font-size:2.2rem; font-weight:700; color:var(--theme); margin-bottom:15px;">NeuroRecall</div>
            <div style="font-size:0.8rem; color:#888; margin-bottom:20px;">Military Grade Hypnosis</div>
            <div class="topic-list">
                <ul id="topic-ul"></ul>
                <div class="topic-count" id="topic-count"></div>
            </div>
            <button class="go" onclick="app.go()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡πâ‡∏≠‡∏ô‡∏à‡∏≥</button>
        </div>

        <!-- Subliminal -->
        <div id="flash">
            <div class="flash-w">‡∏à‡∏≥</div>
        </div>

        <!-- Void -->
        <div id="void">
            <div class="void-t">‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡πÄ‡∏Ç‡πâ‡∏≤‡∏•‡∏∂‡∏Å‡πÜ...</div>
        </div>

        <!-- Done -->
        <div id="done">
            <div style="font-size:4rem; margin-bottom:15px;">üß†</div>
            <div style="font-size:1.4rem; color:var(--theme); font-weight:700; margin-bottom:5px;">
                "‡∏ù‡∏±‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏™‡∏°‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!"</div>
            <div style="font-size:1rem; color:#888; margin-bottom:20px;">‡∏û‡∏£‡∏∞‡πÄ‡∏à‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ó‡∏≠‡∏î‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤‡∏Å‡∏±‡∏ö‡∏à‡∏±‡∏Å‡∏£‡∏ß‡∏≤‡∏•</div>
            <div style="font-size:0.8rem; color:#555;">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <span id="final-watched">0</span> ‡∏Ñ‡∏£‡∏±‡πâ‡∏á | ‡∏ó‡∏ß‡∏ô‡∏ã‡πâ‡∏≥ <span
                    id="final-repeat">0</span> ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
        </div>

        <!-- Timeline -->
        <div class="timeline">
            <div class="t-icon">üåç</div>
            <div id="dots"></div>
            <div class="t-icon">üß†</div>
        </div>
    </div>

    <script>
        // üîä AUDIO ENGINE - MILITARY GRADE ISOCHRONIC
        const AudioEngine = {
            ctx: null,
            init() {
                if (!window.AudioContext) return;
                this.ctx = new (window.AudioContext || window.webkitAudioContext)();

                // 1. Source: Low Base Tone
                const osc = this.ctx.createOscillator();
                osc.frequency.setValueAtTime(110, this.ctx.currentTime); // Deep hum

                // 2. LFO: SQUARE WAVE (Isochronic - Hard Cut)
                const lfo = this.ctx.createOscillator();
                lfo.type = 'square'; // üöÅ HELICOPTER MODE: On/Off sharpness
                lfo.frequency.value = 6;

                const lfoGain = this.ctx.createGain();
                lfoGain.gain.value = 1.0; // Full Modulation (0 to 1) for distinct Phwup Phwup
                lfo.connect(lfoGain.gain);

                // 3. Panner: 3D Rotate
                const panner = this.ctx.createStereoPanner();
                const panLfo = this.ctx.createOscillator();
                panLfo.frequency.value = 0.1;
                panLfo.connect(panner.pan);
                panLfo.start();

                // Chain: Osc -> PulseGain -> Panner -> Master -> Out
                const pulseGain = this.ctx.createGain();
                pulseGain.gain.value = 0.0369; // Master Volume (Keep low generally)

                // Hook up AM Synthesis: Osc -> (Gated by LFO) -> Panner
                osc.connect(pulseGain);

                // The magic: LFO controls the GAIN of pulseGain
                // But we need a base value. If we connect LFO directly to gain, it oscillates around base.
                // For Isochronic, we want 0 to Max.
                // Let's create a dedicated Gain node for chopping.

                const chopper = this.ctx.createGain();
                chopper.gain.value = 0; // Default off, LFO turns it on
                lfo.connect(chopper.gain);

                osc.disconnect();
                osc.connect(chopper);
                chopper.connect(pulseGain);
                pulseGain.connect(panner);
                panner.connect(this.ctx.destination);

                this.gainNode = pulseGain;

                osc.start();
                lfo.start();
            },
            stop() {
                if (this.gainNode) {
                    this.gainNode.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 2);
                    setTimeout(() => { if (this.ctx.state !== 'closed') this.ctx.suspend(); }, 2100);
                }
            },
            resume() {
                if (this.ctx && this.ctx.state === 'suspended') this.ctx.resume();
            }
        };

        // üì± APP
        const app = {
            db: {},
            queue: [],
            original: [],
            total: 0,
            current: 0,
            round: 1,
            watched: 0,
            repeat: 0,
            viewDuration: 15000,
            timer: null,
            progressTimer: null,
            currentInfo: null,
            imprintTime: 0,
            isImprinted: false,

            // üß† SPACED REPETITION: Minimum 45 seconds total per video (3 rounds)
            minTotalWatch: 45000, // 45 seconds = 3 rounds of 15s each

            // ‚ö° FLASHBACK: History of watched items
            watchHistory: [],

            async init() {
                try {
                    const r = await fetch('https://raw.githubusercontent.com/artnp/bigdata/refs/heads/main/reel1.js');
                    const t = await r.text();
                    const m = t.match(/\[([\s\S]*?)\];/);
                    if (m) {
                        (m[1].match(/"[^"]+"/g) || []).forEach(e => {
                            const c = e.slice(1, -1), x = c.indexOf(',');
                            if (x > -1) {
                                const raw = c.substring(0, x), desc = c.substring(x + 1).trim();
                                this.db[raw.split('?')[0]] = { raw, desc, views: 0 };
                            }
                        });
                    }
                } catch (e) { }
                this.load();
            },

            load() {
                const v = new URLSearchParams(location.search).get('v');
                if (v) {
                    this.original = v.split(',').filter(x => x);
                    this.queue = [...this.original];
                    this.total = this.queue.length;
                    this.updateTotal(this.total);

                    const ul = document.getElementById('topic-ul');
                    ul.innerHTML = '';
                    this.original.forEach((id, idx) => {
                        const info = this.db[id.split('?')[0]];
                        if (info) {
                            const li = document.createElement('li');
                            li.textContent = `${idx + 1}. ${info.desc}`;
                            ul.appendChild(li);
                        }
                    });
                    document.getElementById('topic-count').textContent = `‡∏£‡∏ß‡∏° ${this.total} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;

                    const f = this.db[this.queue[0].split('?')[0]];
                    if (f) this.embed(f.raw, false);
                }
            },

            shuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            },

            go() {
                // üöë FIX: Ensure Audio Starts
                if (AudioEngine.ctx && AudioEngine.ctx.state === 'suspended') AudioEngine.ctx.resume();
                else AudioEngine.init();

                document.getElementById('start').style.display = 'none';
                this.setPhase(1);
                this.queue = this.shuffle([...this.original]);
                this.next();
            },

            setPhase(r) {
                document.body.className = '';
                // Phase Color Logic
                if (r === 1) document.body.classList.add('phase-1');
                else if (r === 2) document.body.classList.add('phase-2');
                else document.body.classList.add('phase-3');

                // üéØ PROGRESSIVE FOCUS: Add zoom class
                document.querySelector('.shorts').classList.remove('focus-1', 'focus-2', 'focus-3', 'focus-4');
                document.querySelector('.shorts').classList.add(`focus-${Math.min(r, 4)}`);
            },

            updateTotal(n) { document.getElementById('total-num').textContent = n; },
            updateDots() {
                const d = document.getElementById('dots');
                d.innerHTML = '';
                for (let i = 0; i < 5; i++) {
                    const dot = document.createElement('div');
                    dot.className = 't-dot';
                    if (i < (this.current % 5)) dot.classList.add('ok');
                    d.appendChild(dot);
                }
            },

            // üé¨ ROUND TIMING CONFIG
            getRoundConfig(round) {
                const configs = {
                    1: { startTime: 5, duration: 10000 },   // 5-15s (10 seconds)
                    2: { startTime: 15, duration: 15000 },  // 15-30s (15 seconds)
                    3: { startTime: 30, duration: 20000 },  // 30-50s (20 seconds)
                };
                return configs[round] || configs[3]; // Default to round 3 config
            },

            next() {
                if (this.queue.length === 0) {
                    // üß† SPACED REPETITION: Keep repeating until 60s total watched
                    const needRepeat = this.original.filter(id => {
                        const info = this.db[id.split('?')[0]];
                        return info && (info.totalWatchTime || 0) < this.minTotalWatch;
                    });

                    if (needRepeat.length > 0 && this.round < 5) {
                        this.round++;
                        this.setPhase(this.round);
                        this.queue = this.shuffle([...needRepeat]);
                        this.current = 0;
                        this.updateTotal(this.queue.length);
                        document.getElementById('round').textContent = this.round;
                        this.voidBreak();
                        return;
                    }
                    this.finish();
                    return;
                }

                // Reset UI
                document.querySelector('.shorts').classList.remove('imprint');
                this.imprintTime = 4000 + Math.random() * 8000;
                this.isImprinted = false;

                const fl = document.getElementById('flash');
                fl.style.opacity = '0.4';
                setTimeout(() => fl.style.opacity = '0', 40);

                const id = this.queue[0];
                const info = this.db[id.split('?')[0]] || { raw: id, desc: '...', views: 0, totalWatchTime: 0 };
                this.currentInfo = info;

                // üé¨ ROUND-BASED TIMING CONFIG
                const roundConfig = this.getRoundConfig(this.round);
                this.viewDuration = roundConfig.duration;
                this.embed(info.raw, true, roundConfig.startTime);
                document.getElementById('current-num').textContent = this.current + 1;

                const cap = document.getElementById('cap');
                const txt = document.getElementById('txt');
                txt.style.fontFamily = 'Sarabun, sans-serif';

                // üéØ ROUND-BASED DISPLAY MODES (all use same caption box)
                setTimeout(() => {
                    if (this.round === 1) {
                        // Round 1: Normal display
                        txt.innerHTML = this.proc(info.desc, 0);
                        cap.classList.add('show');
                    } else if (this.round === 2) {
                        // Round 2: Blur random words
                        txt.innerHTML = this.proc(info.desc, 0.4);
                        cap.classList.add('show');
                    } else {
                        // Round 3+: Start with ALL words blurred, then reveal
                        this.rapidSequentialRead(info.desc, txt, cap);
                    }
                }, 300);

                this.updateDots();
                this.startProgress();
            },

            // ‚ö° RAPID SEQUENTIAL READ: Reveal words one by one
            rapidSequentialRead(text, txtEl, capEl) {
                const words = text.split(' ');
                const colors = ['#ff8787', '#ffc9c9', '#69db7c', '#74c0fc', '#da77f2'];
                let revealedCount = 0;
                const wordDuration = 450; // 450ms per word (slower reading)

                // STEP 1: Set ALL words to blurred first
                const allBlurred = words.map(word =>
                    `<span style="color:transparent; text-shadow:0 0 6px rgba(255,255,255,0.5);">${word}</span>`
                ).join(' ');
                txtEl.innerHTML = allBlurred;

                // STEP 2: Show caption box (now has blurred content)
                capEl.classList.add('show');

                const renderWords = () => {
                    const html = words.map((word, i) => {
                        const color = colors[i % colors.length];
                        const m = Math.ceil(word.length / 2);
                        const bionic = `<span style="font-weight:700;">${word.slice(0, m)}</span><span style="opacity:0.85;">${word.slice(m)}</span>`;

                        if (i < revealedCount) {
                            // Already revealed: VISIBLE with color
                            return `<span style="color:${color}; text-shadow:0 0 10px ${color}60;">${bionic}</span>`;
                        } else if (i === revealedCount) {
                            // Currently revealing: HIGHLIGHTED
                            return `<span style="color:${color}; text-shadow:0 0 20px ${color}; font-size:1.1em;">${bionic}</span>`;
                        } else {
                            // Not yet revealed: BLURRED
                            return `<span style="color:transparent; text-shadow:0 0 6px rgba(255,255,255,0.5);">${word}</span>`;
                        }
                    }).join(' ');

                    txtEl.innerHTML = html;
                };

                const revealNext = () => {
                    if (revealedCount > words.length) {
                        // All done - show final state (all visible)
                        txtEl.innerHTML = this.proc(text, 0);
                        return;
                    }

                    renderWords();
                    revealedCount++;
                    setTimeout(revealNext, wordDuration);
                };

                // STEP 3: Start revealing after delay
                setTimeout(revealNext, 1000);
            },

            // Censor function merged into proc below

            embed(raw, auto, startTime = 0) {
                const [vid] = raw.split('?');
                let s = startTime;
                if (raw.includes('start=') && startTime === 0) {
                    s = raw.split('start=')[1];
                }
                const a = auto ? 1 : 0;
                document.getElementById('video').innerHTML = `<iframe src="https://www.youtube.com/embed/${vid}?autoplay=${a}&start=${s}&controls=0&loop=1&playlist=${vid}&playsinline=1&modestbranding=1&rel=0&mute=0" allow="autoplay"></iframe>`;
            },

            proc(t, censorRate = 0) {
                if (!t) return "";
                const colors = ['#ff8787', '#ffc9c9', '#69db7c', '#74c0fc', '#da77f2'];

                const words = t.split(' ');
                const total = words.length;

                // üõ°Ô∏è SMART BLUR: Cap at 50% max, ensure at least 2 words visible
                const maxBlur = Math.min(Math.floor(total * 0.5), Math.floor(total * censorRate));
                const minVisible = Math.max(2, Math.ceil(total * 0.3)); // At least 30% or 2 words visible
                const actualBlurCount = Math.min(maxBlur, total - minVisible);

                // Pre-select which indices to blur (random selection)
                const blurIndices = new Set();
                while (blurIndices.size < actualBlurCount) {
                    blurIndices.add(Math.floor(Math.random() * total));
                }

                return words.map((x, i) => {
                    // Censor only pre-selected words
                    if (blurIndices.has(i)) {
                        // üå´Ô∏è RELIABLE BLUR: Transparent text + Shadow
                        return `<span style="color:transparent; text-shadow:0 0 8px rgba(255,255,255,0.8); user-select:none;">${x}</span>`;
                    }

                    // Normal Rainbow Bionic
                    const m = Math.ceil(x.length / 2);
                    const bionic = `<span style="font-weight:700; opacity:1;">${x.slice(0, m)}</span><span style="opacity:0.85;">${x.slice(m)}</span>`;
                    const c = colors[i % colors.length];
                    // Immersive Neon Glow
                    return `<span style="color:${c}; text-shadow:0 0 12px ${c}80; filter:contrast(1.2);">${bionic}</span>`;
                }).join(' ');
            },
            startProgress() {
                let elapsed = 0;
                const interval = 100;
                document.getElementById('progress').style.width = '0%';

                this.progressTimer = setInterval(() => {
                    elapsed += interval;
                    const pct = (elapsed / this.viewDuration) * 100;
                    document.getElementById('progress').style.width = pct + '%';

                    if (!this.isImprinted && elapsed >= this.imprintTime) {
                        this.isImprinted = true;
                        document.querySelector('.shorts').classList.add('imprint');
                    }

                    if (elapsed >= this.viewDuration) {
                        this.advance();
                    }
                }, interval);
            },

            advance() {
                clearInterval(this.progressTimer);
                document.querySelector('.shorts').classList.remove('imprint');

                this.queue.shift();
                if (this.currentInfo) {
                    this.currentInfo.views = (this.currentInfo.views || 0) + 1;
                    // üß† SPACED REPETITION: Track total watch time
                    this.currentInfo.totalWatchTime = (this.currentInfo.totalWatchTime || 0) + this.viewDuration;

                    if (this.currentInfo.views === 1) this.watched++;
                    else this.repeat++;

                    // ‚ö° FLASHBACK: Add to history for future flashbacks
                    if (!this.watchHistory.find(h => h.desc === this.currentInfo.desc)) {
                        this.watchHistory.push({ desc: this.currentInfo.desc });
                    }
                }

                this.current++;
                document.getElementById('watched').textContent = this.watched;
                document.getElementById('repeat').textContent = this.repeat;

                setTimeout(() => this.next(), 600);
            },

            voidBreak() {
                const v = document.querySelector('#void .void-t');
                const voidEl = document.getElementById('void');

                // üå¨Ô∏è INHALE: Smooth wind in
                v.innerHTML = `<div class="breath-font" style="
                    background-image: linear-gradient(120deg, #69db7c, #20c997, #3bc9db, #4dabf7);
                    animation: windIn 4s ease-out forwards;
                ">‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡πÄ‡∏Ç‡πâ‡∏≤</div>`;

                voidEl.style.transition = 'none';
                voidEl.style.opacity = '1';
                document.getElementById('video').style.opacity = '0';

                // üå¨Ô∏è EXHALE: Smooth wind out
                setTimeout(() => {
                    v.innerHTML = `<div class="breath-font" style="
                        background-image: linear-gradient(120deg, #da77f2, #b197fc, #748ffc, #3bc9db);
                        animation: windOut 4s ease-in forwards;
                    ">‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏≠‡∏≠‡∏Å</div>`;
                }, 4000);

                // END
                setTimeout(() => {
                    voidEl.style.opacity = '0';
                    document.getElementById('video').style.opacity = '1';
                    this.next();
                }, 8000);
            },

            embed(raw, auto, startTime = 0) {
                const [vid] = raw.split('?');
                let s = startTime;
                if (raw.includes('start=') && startTime === 0) {
                    s = raw.split('start=')[1];
                }
                const a = auto ? 1 : 0;
                document.getElementById('video').innerHTML = `<iframe src="https://www.youtube.com/embed/${vid}?autoplay=${a}&start=${s}&controls=0&loop=1&playlist=${vid}&playsinline=1&modestbranding=1&rel=0&mute=0" allow="autoplay"></iframe>`;
            },

            finish() {
                clearInterval(this.progressTimer);
                document.getElementById('video').innerHTML = '';
                document.getElementById('final-watched').textContent = this.watched;
                document.getElementById('final-repeat').textContent = this.repeat;
                document.getElementById('done').style.display = 'flex';
                AudioEngine.stop();
            }
        };

        window.onload = () => app.init();
    </script>
</body>

</html>